
# 

---

### 1️⃣ `Présentation`
### 2️⃣ `Utilisation`
### `COMMANDES`

---

## 1️⃣ **Présentation**

[DOC OFFICIEL](https://developer.hashicorp.com/vault/docs/secrets/kv)

### -1. `[NOTE]` 

Le **K/V secrets engine** et le **storage backend** interviennent à deux niveaux distincts de l’architecture Vault :

- **K/V secrets engine** : couche **applicative** offrant une abstraction logique et une interface pour gérer les secrets.
- **Storage backend** : couche **infrastructure** assurant la **persistance physique et chiffrée** des données.

=> Le K/V gère la logique des secrets, tandis que le storage backend stocke les données de manière sécurisée.

---

### -2. `K/V`

Le `K/V (Key/Value)` est un moteur de secrets dans Vault qui fournit `une couche logique d’abstraction` pour organiser, `structurer et contrôler` l’accès aux secrets par les utilisateurs et les applications.

`Rôle et fonctionnement du K/V`

Le **K/V secrets engine** permet de :

- Organiser les secrets en paires clé-valeur dans une arborescence hiérarchique  
- Exposer une API HTTP (CRUD : create, read, update, delete)  
- Appliquer un contrôle d’accès granulaire via des politiques  
- Gérer les métadonnées (timestamps, versions, etc.)  
- (KV v2) Gérer le cycle de vie : versioning, suppression logique et restauration  

### **Deux Versions**

| Caractéristique                     | KV v1                                   | KV v2                                                  |
|--------------------------------------|------------------------------------------|--------------------------------------------------------|
| Versioning                           | Non                                      | Oui (automatique à chaque modification)                |
| Gestion des versions                 | Une seule valeur actuelle                | Historique complet des versions                        |
| Suppression                          | Définitive                               | Logique (restauration possible)                        |
| Destruction définitive               | Oui (immédiate)                          | Oui (optionnelle après suppression logique)            |
| Métadonnées                          | Minimales                                | Enrichies (created_time, deletion_time, destroyed…)    |
| Performance / Complexité             | Plus simple et légèrement plus performant| Plus complet avec logique de gestion avancée           |
| Cas d’usage recommandé               | Secrets peu modifiés                     | Environnements nécessitant traçabilité et sécurité     |

### **Use Case**

| Cas d’usage                            | KV v1                                         | KV v2                                                    |
|----------------------------------------|-----------------------------------------------|----------------------------------------------------------|
| Type de secrets                        | Secrets qui changent rarement ou jamais      | Secrets qui changent régulièrement                       |
| Exemples                               | - Certificats SSL/TLS                         | - Passwords d’applications (rotation fréquente)         |
|                                        | - Clés API tierces (Stripe, Twilio)          | - Tokens temporaires                                     |
|                                        | - Configurations statiques                    | - Credentials nécessitant audit trail                    |
|                                        | - Secrets partagés entre équipes             | - Environnements de production                           |
|                                        | - Environnements simples (dev/test)          | - Compliance/réglementation (traçabilité requise)       |
| Avantages                              | Plus simple, léger, pas besoin d’historique  | Versioning, rollback, soft delete, audit                 |


---

### -3. `Policy, Actions Possibles et Commandes K/V v1`

-`Policy`

Les policy sont sensiblement les même que pour les autres parties de Vault

`[EXEMPLE_SYNTAXE]`

<img width="1250" height="693" alt="image" src="https://github.com/user-attachments/assets/d750a119-ad15-4c61-893b-8b0769b14ead" />

- Ici le seul chemin par defaut est `/secret`



- `Actions Possibles`

| Action / Fonctionnalité       | Statut                     |
|--------------------------------|----------------------------|
| **Données (Data)**             |                            |
| Create                         | ✅                         |
| Read                           | ✅                         |
| Update                         | ✅                         |
| Delete                         | ✅ (définitif)             |
| List                           | ✅                         |
| **Métadonnées (Metadata)**     |                            |
| Create                         | ❌                         |
| Read                           | ❌                         |
| Update                         | ❌                         |
| Delete                         | ❌                         |
| List                           | ❌                         |



- `Commandes` (Non exaustives, à titre d'exemple...)
 
- **put** => créer un secret ou si existant update

`[EXPLICATION]`
```
vault kv put secret/access ttl=30m username=admin password=secret123                          
```
`[NOTE]` Le `ttl` est à titre indixatif pour l'utilisateur

- Sortie :
```
Success! Data written to: secret/access
```

```
vault kv put secret/access  ttl=30m username=admin password=secret123  
└───┘ └┘ └─┘ └────────────┘ └────┘ └────────────┘ └─────────────────┘
  │    │   │         │         │         │               |
  │    │   │         │         │         │               |
  │    │   │    Clé Vault    Arg 1      Arg 2          Arg 3
  │    │   │                                  
  │    │  Action                             
  │   Type                                   
 CLI                                         
```

⬆️

| Élément | Valeur | Rôle |
|---------|--------|------|
| `vault` | Commande de base | CLI Vault |
| `kv` | Sous-commande | Opération K/V |
| `put` | Action | Écrire/créer |
| `secret/access` | Chemin | **Clé Vault** |
| `ttl=30m` | Argument 1 | Paire clé-valeur JSON |
| `username=admin` | Argument 2 | Paire clé-valeur JSON |
| `password=secret123` | Argument 3 | Paire clé-valeur JSON |

- **get** Lit le secret
```
vault kv get secret/database
```

- Sortie :
```
====== Data ======
Key         Value
---         -----
password    secret123
username    admin
---


### -4. `Policy, Actions Possibles et Commandes K/V v2`




`[NOTE]` Possibilité de `Versioning`



- `Actions Possibles`

| Action / Fonctionnalité       | Statut                                  |
|--------------------------------|----------------------------------------|
| **Données (Data)**             |                                        |
| Create                         | ✅                                      |
| Read                           | ✅ (toutes versions)                    |
| Update                         | ✅ (crée nouvelle version)              |
| Delete                         | ✅ (soft delete)                        |
| List                           | ✅                                      |
| Undelete                       | ✅ (restaurer)                          |
| Destroy                        | ✅ (suppression définitive)             |
| Patch                          | ✅ (mise à jour partielle)              |
| Rollback                       | ✅ (revenir à version antérieure)      |
| **Métadonnées (Metadata)**     |                                        |
| Create                         | ✅                                      |
| Read                           | ✅                                      |
| Update                         | ✅                                      |
| Delete                         | ✅                                      |
| List                           | ✅                                      |


- `Commandes`

---
---

## 2️⃣ **Utilisation**


---
---

### **COMMANDES**


``


-Sortie


---


``


-Sortie


---

``


-Sortie


---

``


-Sortie


---

``


-Sortie


---

``


-Sortie


---


 [CHOSES A RETENIR]

