
# 

---

### 1️⃣ `Présentation`
### 2️⃣ `Utilisation`
### `COMMANDES`

---

### 1️⃣ **Présentation**

`[RAPPEL]` => VU dans la section [-5-Authentification](https://github.com/NALSED/TUTO/blob/main/PERSO/VAULT/FONCTIONNEMENT/-5-Authentification.md)
```
USER                    VAULT                    AUTH BACKEND
                                                  (LDAP/AD/GitHub/etc.)
│                       │                              │
│  1. Login request     │                              │
│  (username/password)  │                              │
│──────────────────────>│                              │
│                       │                              │
│                       │  2. Vérification identité    │
│                       │─────────────────────────────>│
│                       │                              │
│                       │  3. OK + groupes/infos       │
│                       │<─────────────────────────────│
│                       │                              │
│                       │  4. Mapping groupes          │
│                       │     → policies Vault         │
│                       │                              │
│  5. TOKEN + policies  │                              │
│<──────────────────────│                              │
│                       │                              │
│  6. Requêtes avec     │                              │
│     token             │                              │
│──────────────────────>│                              │
│                       │                              │
│  7. Secrets           │                              │
│   (si autorisé)       │                              │
│<──────────────────────│                              │
```

### **- Génération du Credential DB**
```
USER                    VAULT                      DATABASE
      │                       │                              │
      │  1. Demande secret    │                              │
      │  (path: db/creds/my-role)                            │
      │──────────────────────>│                              │
      │                       │                              │
      │                       │  2. Vérifie token            │
      │                       │     + policies ACL           │
      │                       │                              │
      │                       │  3. Génère credential        │
      │                       │─────────────────────────────>│
      │                       │                              │
      │                       │  4. Crée user + GRANT        │
      │                       │<─────────────────────────────│
      │                       │                              │
      │  5. login + password  │                              │
      │     + lease_id + TTL  │                              │
      │<──────────────────────│                              │
      │                       │                              │
      │  6. Connexion DB      │                              │
      │─────────────────────────────────────────────────────>│
      │                       │                              │
      │  7. Session active    │                              │
      │<─────────────────────────────────────────────────────│
```

### **- Résumé RENEW / ROTATION / REVOCATION**
```
# Credential Lifecycle — Rotation · Renewal · Revocation

```
USER                         VAULT                        DATABASE
  │                            │                              │
  │                            │                              │
  │   ┌────────────────────────┼──────────────────────────────┼───────────────────────┐
  │   │ RENEWAL                │                              │                       │
  │   │                        │                              │                       │
  │   │  renew-self ─────────> │  vérifie max_ttl             │                       │
  │   │  (avant expiration)    │  étend le lease              │                       │
  │   │  nouveau TTL <──────── │                              │                       │
  │   └────────────────────────┼──────────────────────────────┼───────────────────────┘
  │                            │                              │
  │                            │  ┌───────────────────────────┼───────────────────────┐
  │                            │  │ ROTATION                  │                       │
  │                            │  │                           │                       │
  │                            │  │  TTL expiré /             │                       │
  │                            │  │  rotation forcée          │                       │
  │                            │  │  génère nouveau ────────> │  update password      │
  │                            │  │  credential    <───────── │  confirmation         │
  │                            │  │  révoque ancien ────────> │  drop old creds       │
  │  nouveau lease_id <─────── │  │                           │                       │
  │  + new credentials         │  └───────────────────────────┼───────────────────────┘
  │                            │                              │
  │   ┌────────────────────────┼──────────────────────────────┼───────────────────────┐
  │   │ REVOCATION             │                              │                       │
  │   │                        │                              │                       │
  │   │  revoke ────────────>  │  invalide lease              │                       │
  │   │  (manuel / incident /  │  immédiatement ───────────>  │  DROP USER            │
  │   │   fin de vie)          │                  <─────────── │  REVOKE GRANT         │
  │   │                        │  purge secret                │                       │
  │   │                        │  + audit log                 │                       │
  │   │  accès refusé <─────── │                              │                       │
  │   └────────────────────────┼──────────────────────────────┼───────────────────────┘
  │                            │                              │
```

---

```
  RENEWAL    →  même credential,  TTL étendu,   pas de changement DB
  ROTATION   →  nouveau credential, ancien révoqué, DB mise à jour
  REVOCATION →  credential détruit, session coupée, user DB supprimé
```
```
### -1. `Use case`

<img width="1126" height="838" alt="image" src="https://github.com/user-attachments/assets/b28149a6-52ce-4198-a59e-900d10f4f7bc" />

- Secret à la demande pour un usage bien précis

### -. ``



### -. ``




###-. ``

---
---

### 2️⃣ **Utilisation**

### -6. `Détruire un secret`

- 
```

```


-
```

```

-
```

```



-
```

```



-
```

```

---
---

### **COMMANDES**


``


-Sortie


---


``


-Sortie


---

``


-Sortie


---

``


-Sortie


---

``


-Sortie


---

``


-Sortie


---


 [CHOSES A RETENIR]
